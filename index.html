<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#16a34a" id="themeColor">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="apple-mobile-web-app-title" content="Redirect">
	<meta name="mobile-web-app-capable" content="yes">
    <title>Открываем ссылку…</title>
    <!-- Montserrat font + общие стили проекта -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://speedtest.incdev.net/styles/variables.css?100">
    <link rel="stylesheet" href="https://speedtest.incdev.net/styles/base.css?100">
    <link rel="stylesheet" href="https://speedtest.incdev.net/styles/components.css?100">
    <link rel="stylesheet" href="https://speedtest.incdev.net/styles/responsive.css?100">
    <style>
        /* Узкие экраны (iPhone SE и подобные) */
        @media (max-width: 360px) {
            .platform-card { padding: 16px !important; }
            .card-content { padding: 14px !important; }
            .steps-hint { padding: 8px 10px !important; }
            .steps-inline { gap: 6px !important; font-size: 13px; }
            .step-badge { width: 20px; height: 20px; font-size: 11px; }
            .btn { padding: 10px 12px; font-size: 13px; }
        }
        /* Безопасные области (верх/низ) и динамическая высота */
        .redirect-shell { min-height: 100dvh; padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); }
        .steps-inline { flex-wrap: wrap; max-width: 100%; }
        .step-inline-item { max-width: 100%; }
    </style>
</head>
<body>
    <!-- Лоадер в стиле основного приложения -->
    <div id="appLoader" class="loading-overlay" role="status" aria-live="polite" aria-busy="true">
        <div class="loader-spinner" aria-hidden="true"></div>
    </div>
    <div class="container redirect-shell" style="display:flex;align-items:center;justify-content:center;">
        <main id="mainContent" style="width:100%;max-width:680px;">
            <section class="platform-screen" style="max-width:680px;width:100%;padding-left: 10px;padding-right: 10px;">
                <div class="platform-card card" style="animation: fadeIn .25s ease-out;">
                    <div class="card-content" style="text-align:center;">
                        <div class="steps-hint" role="note" aria-label="Redirect info" style="margin-bottom:0;">
                            <div class="steps-inline" style="gap:10px;">
                                <div class="step-inline-item"><span class="step-badge">1</span><span>Открываем ссылку…</span></div>
                                <div class="step-inline-item"><span class="step-badge">2</span><span>Если не открылось — нажмите кнопку</span></div>
                            </div>
                        </div>
                        <div style="margin-top:16px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap;">
                            <button id="openBtn" class="btn btn-primary"><span>Открыть ссылку</span></button>
                            <button id="supportBtn" class="btn"><span>Поддержка</span></button>
                        </div>
                        <div class="loading-indicator" style="margin-top:12px;display:flex;align-items:center;justify-content:center;gap:6px;color:var(--text-muted);font-size:14px;">
                            <div class="spinner" style="width:14px;height:14px;border:2px solid var(--border);border-top:2px solid var(--primary-color);border-radius:50%;animation: spin .9s linear infinite;"></div>
                            <span>Автоматическое перенаправление через <span id="countdown" style="color:var(--primary-color);font-weight:800;">5</span> сек…</span>
                        </div>
					<p id="instructions" style="margin-top:10px;color:var(--text-secondary);white-space:pre-line;">Если этого не произошло, нажмите «Открыть ссылку».</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

	<script>
	document.addEventListener('DOMContentLoaded', function () {
		function setFullscreen() {
			const vh = window.innerHeight * 0.01;
			document.documentElement.style.setProperty('--vh', `${vh}px`);
			window.addEventListener('resize', () => {
				const vh = window.innerHeight * 0.01;
				document.documentElement.style.setProperty('--vh', `${vh}px`);
			});
			window.scrollTo(0, 1);
			setTimeout(() => { window.scrollTo(0, 0); }, 100);
		}
		setFullscreen();
		if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
			document.documentElement.classList.add('dark-theme');
		}

		const currentURL = window.location.href;
		let redirectTo = '';
		try {
			redirectTo = decodeURIComponent((currentURL.split('redirect_to=')[1] || '').split('&')[0]);
		} catch { redirectTo = ''; }

		const countdownEl = document.getElementById('countdown');
		const instructionsEl = document.getElementById('instructions');
		const openBtn = document.getElementById('openBtn');
		const loadingIndicator = document.querySelector('.loading-indicator');
		const instructionsText = 'Автоматическое перенаправление через {seconds} секунд.\nЕсли этого не произошло, нажмите на кнопку выше.';

		if (openBtn) {
			openBtn.addEventListener('click', () => { if (redirectTo) window.location.href = redirectTo; });
		}
		const supportBtn = document.getElementById('supportBtn');
		if (supportBtn) {
			supportBtn.addEventListener('click', () => { window.location.href = 'https://t.me/incvpn_support'; });
		}

		if (redirectTo) {
			let countdown = 5;
			const update = () => {
				if (countdownEl) countdownEl.textContent = String(countdown);
				if (instructionsEl) instructionsEl.textContent = instructionsText.replace('{seconds}', countdown);
			};
			update();
			const timer = setInterval(() => {
				countdown--;
				update();
				if (countdown <= 0) {
					clearInterval(timer);
					window.location.href = redirectTo;
				}
			}, 1000);
		} else {
			if (instructionsEl) instructionsEl.textContent = 'Не указана ссылка для перенаправления.';
			if (loadingIndicator) loadingIndicator.style.display = 'none';
		}
	});
	</script>
</body>
</html>


